<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>php-build</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>php-build</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><p>Preserve STDERR on FD3, so we can easily log build
errors on FD2 to a file and use FD3 for php-build's
visible error messages.</p>

</pre></div></td></tr><tr><td class=docs>

<p>Simpe function for resolving a
relative path to an absolute one
by only using <code>cd -L</code>.</p>

<p>This is needed because BSD's <code>readlink</code> does not
support the <code>-f</code> flag which is an issue on OSX.</p>

</td><td class=code><div class=highlight><pre>
<span class="c">#!/bin/bash</span>
<span class="c">#/ php-build, Builds PHP with recipes.</span>
<span class="c">#/</span>
<span class="c">#/ Usage: php-build [--definitions] [--ini|i &lt;environment&gt;] [&lt;definition&gt;] [&lt;prefix&gt;]</span>
<span class="c">#/</span>
<span class="c">#/ Arguments:</span>
<span class="c">#/   definition:    What release should be used, as well as release-specific</span>
<span class="c">#/                  configuration.</span>
<span class="c">#/   prefix:        All built Executables, Configs and Libs are placed in this</span>
<span class="c">#/                  directory. It&#39;s created if it doesn&#39;t exist.</span>
<span class="c">#/</span>
<span class="c">#/ Options:</span>
<span class="c">#/   --definitions: Lists all available definitions</span>
<span class="c">#/   --ini|i:       Specifies which php.ini-&lt;environment&gt; from the</span>
<span class="c">#/                  source distribution is used as default php.ini</span>
<span class="c">#/</span>

<span class="nb">set</span> -e

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$PHP_BUILD_DEBUG&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="nb">set</span> -x
<span class="k">fi</span>

<span class="nb">exec </span>3&lt;&amp;2

</pre></div></td></tr><tr><td class=docs>

<p>If <code>-i</code> or <code>--ini</code> is given as first argument, then
treat the second argument as <code>php.ini</code> file. If this
file does not exist, than it is looked up later
in the PHP package.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">function </span>realpath <span class="o">{</span>
    <span class="nb">local </span><span class="nv">path</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>

    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$path&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nb">echo</span> <span class="s2">&quot;realpath: Path is empty&quot;</span> &gt;&amp;3
        <span class="k">return </span>1
    <span class="k">fi</span>

<span class="k">    </span><span class="nb">local </span><span class="nv">cwd</span><span class="o">=</span><span class="s2">&quot;$(pwd)&quot;</span>

    <span class="nb">cd</span> -L <span class="s2">&quot;$path&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;$(pwd)&quot;</span>
    <span class="nb">cd</span> <span class="s2">&quot;$cwd&quot;</span>
<span class="o">}</span>

<span class="nv">PHP_BUILD_ROOT</span><span class="o">=</span><span class="k">$(</span>realpath <span class="s2">&quot;$(dirname $0)/..&quot;</span><span class="k">)</span>
<span class="nv">TMP</span><span class="o">=</span><span class="s2">&quot;$PHP_BUILD_ROOT/tmp/php-build&quot;</span>
<span class="nv">PHP_DEFAULT_INI</span><span class="o">=</span>

<span class="nv">CONFIGURE_OPTIONS</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/default_configure_options&quot;</span><span class="k">)</span>

</pre></div></td></tr><tr><td class=docs>

<p>Processes the Help front matter of the script
and displays it on STDERR.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;-i&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;--ini&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    if</span> <span class="o">[</span> -f <span class="s2">&quot;$2&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">PHP_DEFAULT_INI</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">PHP_DEFAULT_INI</span><span class="o">=</span><span class="s2">&quot;php.ini-$2&quot;</span>
    <span class="nb">shift</span>
<span class="nb">    shift</span>
<span class="k">fi</span>

<span class="nv">DEFINITION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">PREFIX</span><span class="o">=</span><span class="nv">$2</span>

<span class="nv">E_DEFINITION_NOT_FOUND</span><span class="o">=</span>127

</pre></div></td></tr><tr><td class=docs>

<p>This function sets and unsets arguments for <code>configure</code>. Pass it
the <code>-D</code> option to unset the argument given in <code>$2</code>. Otherwise
the first argument is the name of the option and the second
argument contains the optional value.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">function </span>display_usage <span class="o">{</span>
    grep <span class="s1">&#39;^#/&#39;</span> &lt;<span class="s2">&quot;$0&quot;</span> | cut -c4- &gt;&amp;3
<span class="o">}</span>

<span class="k">function </span>init <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$TMP&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir <span class="s2">&quot;$TMP&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$TMP/packages&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir <span class="s2">&quot;$TMP/packages&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$TMP/source&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir <span class="s2">&quot;$TMP/source&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$PHP_BUILD_ROOT/var/log/php-build&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir -p <span class="s2">&quot;$PHP_BUILD_ROOT/var/log/php-build&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/after-install.d&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir -p <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/after-install.d&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>log <span class="o">{</span>
    <span class="nb">local </span><span class="nv">marker</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>
    <span class="nb">local </span><span class="nv">text</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>

    <span class="nb">echo</span> <span class="s2">&quot;    [$marker]:  $text&quot;</span> &gt;&amp;3
<span class="o">}</span>

<span class="k">function </span>is_osx <span class="o">{</span>
    <span class="nb">local </span><span class="nv">uname</span><span class="o">=</span><span class="k">$(</span>uname<span class="k">)</span>

    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$uname&quot;</span> <span class="o">=</span> <span class="s2">&quot;Darwin&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        return </span>0
    <span class="k">else</span>
<span class="k">        return </span>1
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>download <span class="o">{</span>
    <span class="nb">local </span><span class="nv">url</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">package_file</span><span class="o">=</span><span class="s2">&quot;$TMP/packages/$(basename $url)&quot;</span>
    <span class="nb">local </span><span class="nv">temp_package</span><span class="o">=</span><span class="s2">&quot;$TMP/$(basename $url)&quot;</span>

    log <span class="s2">&quot;Downloading&quot;</span> <span class="s2">&quot;$url&quot;</span>

    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;$temp_package&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>rm <span class="s2">&quot;$temp_package&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> ! -f <span class="s2">&quot;$package_file&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>wget -qP <span class="s2">&quot;$TMP&quot;</span> <span class="s2">&quot;$url&quot;</span> &gt; /dev/null
        cp <span class="s2">&quot;$temp_package&quot;</span> <span class="s2">&quot;$TMP/packages&quot;</span>
        rm <span class="s2">&quot;$temp_package&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> -d <span class="s2">&quot;$TMP/source/$DEFINITION&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>rm -rf <span class="s2">&quot;$TMP/source/$DEFINITION&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span>mkdir <span class="s2">&quot;$TMP/source/$DEFINITION&quot;</span>

    tar -xj --strip-components 1 -f <span class="s2">&quot;$package_file&quot;</span> -C <span class="s2">&quot;$TMP/source/$DEFINITION&quot;</span>
    <span class="k">return</span> <span class="nv">$?</span>
<span class="o">}</span>

<span class="k">function </span>list_definitions <span class="o">{</span>
    <span class="o">{</span>
        <span class="k">for </span>definition in <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/definitions/&quot;</span>*
        <span class="k">do</span>
<span class="k">            </span><span class="nb">echo</span> <span class="k">$(</span>basename <span class="s2">&quot;$definition&quot;</span><span class="k">)</span>
        <span class="k">done</span>
    <span class="o">}</span> | sort &gt;&amp;3
<span class="o">}</span>

<span class="k">function </span>install_package <span class="o">{</span>
    <span class="nb">local </span><span class="nv">url</span><span class="o">=</span><span class="nv">$1</span>

    <span class="o">{</span>
        download <span class="nv">$url</span>
        build_package <span class="s2">&quot;$TMP/source/$DEFINITION&quot;</span>
    <span class="o">}</span> &gt;&amp;4 2&gt;&amp;1
<span class="o">}</span>

<span class="k">function </span>trigger_after_install <span class="o">{</span>
    <span class="nb">export </span>PHP_BUILD_ROOT
    <span class="nb">export </span>PREFIX
    <span class="nb">local </span><span class="nv">triggers_dir</span><span class="o">=</span><span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/after-install.d/&quot;</span>
    <span class="nb">local </span><span class="nv">triggers</span><span class="o">=</span><span class="k">$(</span>ls <span class="s2">&quot;$triggers_dir&quot;</span><span class="k">)</span>

    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$triggers&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        for </span>trigger in <span class="s2">&quot;$triggers_dir&quot;</span>*; <span class="k">do</span>
<span class="k">            </span>log <span class="s2">&quot;After Install Trigger&quot;</span> <span class="s2">&quot;$(basename $trigger)&quot;</span>
            <span class="s2">&quot;$trigger&quot;</span> 2&gt;&amp;4
        <span class="k">done</span>
<span class="k">    fi</span>
<span class="o">}</span>

<span class="k">function </span>load_plugins <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        return </span>1
    <span class="k">fi</span>

<span class="k">    for </span>plugin in <span class="s2">&quot;$1/&quot;</span>*.sh
    <span class="k">do</span>
<span class="k">        </span><span class="nb">source</span> <span class="nv">$plugin</span>
        <span class="nb">echo</span> <span class="s2">&quot;Loaded $(basename $plugin .sh) Plugin.&quot;</span>
    <span class="k">done</span>
<span class="o">}</span>

<span class="k">function </span>build_package <span class="o">{</span>
    <span class="nb">local </span><span class="nv">source_path</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">cwd</span><span class="o">=</span><span class="s2">&quot;$(pwd)&quot;</span>

    <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$PREFIX&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir <span class="s2">&quot;$PREFIX&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span>configure_package <span class="s2">&quot;$source_path&quot;</span>

    log <span class="s2">&quot;Make&quot;</span> <span class="s2">&quot;$source_path&quot;</span>

    <span class="nb">cd</span> <span class="s2">&quot;$source_path&quot;</span>
    make &gt; /dev/null
    make install &gt; /dev/null
    <span class="nb">cd</span> <span class="s2">&quot;$cwd&quot;</span>

    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$PHP_DEFAULT_INI&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        if</span> <span class="o">[</span> -f <span class="s2">&quot;$source_path/$PHP_DEFAULT_INI&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;Using $PHP_DEFAULT_INI as php.ini&quot;</span>
            cp <span class="s2">&quot;$source_path/$PHP_DEFAULT_INI&quot;</span> <span class="s2">&quot;$PREFIX/etc/php.ini&quot;</span>
        <span class="k">else</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;$PHP_DEFAULT_INI not found in $source_path&quot;</span> &gt;&amp;3
        <span class="k">fi</span>
<span class="k">    fi</span>

<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Done.&quot;</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>

<p>This variable will contain the filtered arguments.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_option <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;-D&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>

<p>If the argument starts with the given string in <code>$1</code>
then skip it from concatenation. Otherwise add it to
the filtered options.</p>

</td><td class=code><div class=highlight><pre>
        <span class="nb">local </span><span class="nv">filtered</span><span class="o">=</span>

        <span class="k">for </span>option in <span class="nv">$CONFIGURE_OPTIONS</span>; <span class="k">do</span>
</pre></div></td></tr><tr><td class=docs>

<p>Trim the leading whitespace added in the concatenation.</p>

</td><td class=code><div class=highlight><pre>
            <span class="k">case</span> <span class="s2">&quot;$option&quot;</span> in
                <span class="s2">&quot;$2&quot;</span>*<span class="o">)</span> ;;
                *<span class="o">)</span> <span class="nv">filtered</span><span class="o">=</span><span class="s2">&quot;$filtered $option&quot;</span>;;
            <span class="k">esac</span>
<span class="k">        done</span>
        
</pre></div></td></tr><tr><td class=docs>

<p>Then replace the old argument list with the new one.</p>

</td><td class=code><div class=highlight><pre>
        <span class="nv">filtered</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;$filtered&quot;</span> | sed -e <span class="s1">&#39;s/[ ]*//&#39;</span><span class="k">)</span>

</pre></div></td></tr><tr><td class=docs>

<p>Compile PHP with SSL support</p>

</td><td class=code><div class=highlight><pre>
        <span class="nv">CONFIGURE_OPTIONS</span><span class="o">=</span><span class="s2">&quot;$filtered&quot;</span>
        <span class="k">return </span>0
    <span class="k">else</span>
<span class="k">        if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;-R&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span>configure_option -D <span class="s2">&quot;$2&quot;</span>
            configure_option <span class="s2">&quot;$2&quot;</span> <span class="s2">&quot;$3&quot;</span>
            <span class="k">return </span>0
        <span class="k">fi</span>
<span class="k">    fi</span>

<span class="k">    </span><span class="nv">CONFIGURE_OPTIONS</span><span class="o">=</span><span class="s2">&quot;$CONFIGURE_OPTIONS $1&quot;</span>

    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$2&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">CONFIGURE_OPTIONS</span><span class="o">=</span><span class="s2">&quot;$CONFIGURE_OPTIONS=$2&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>

<p>Here the magic begins.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">function </span>with_openssl <span class="o">{</span>
    <span class="nv">stub</span><span class="o">=</span>1
<span class="o">}</span>

<span class="k">function </span>configure_package <span class="o">{</span>
    <span class="nb">local </span><span class="nv">source_path</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">backup_pwd</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>

    <span class="k">if </span>is_osx; <span class="k">then</span>
<span class="k">        </span>configure_option -D <span class="s2">&quot;--with-gettext&quot;</span>
        configure_option -D <span class="s2">&quot;--with-readline&quot;</span>
        configure_option <span class="s2">&quot;--with-libedit&quot;</span>

        configure_option -D <span class="s2">&quot;--with-png-dir&quot;</span>
        configure_option <span class="s2">&quot;--with-png-dir&quot;</span> <span class="s2">&quot;/usr/X11&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nb">local </span><span class="nv">argv</span><span class="o">=</span><span class="s2">&quot;$CONFIGURE_OPTIONS \</span>
<span class="s2">--with-config-file-path=&quot;</span><span class="nv">$PREFIX</span>/etc<span class="s2">&quot; \</span>
<span class="s2">--with-config-file-scan-dir=&quot;</span><span class="nv">$PREFIX</span>/etc/conf.d<span class="s2">&quot; \</span>
<span class="s2">--prefix=$PREFIX&quot;</span>
    
    log <span class="s2">&quot;Configure&quot;</span> <span class="s2">&quot;$source_path&quot;</span>

    <span class="nb">cd</span> <span class="s2">&quot;$source_path&quot;</span>

    <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;$PREFIX/etc/conf.d&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>mkdir -p <span class="s2">&quot;$PREFIX/etc/conf.d&quot;</span>
    <span class="k">fi</span>

<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$(uname -p)&quot;</span> <span class="o">=</span> <span class="s2">&quot;x86_64&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">argv</span><span class="o">=</span><span class="s2">&quot;$argv --with-libdir=lib64&quot;</span>
    <span class="k">fi</span>

    ./configure <span class="nv">$argv</span> &gt; /dev/null

    <span class="nb">cd</span> <span class="s2">&quot;$backup_pwd&quot;</span>
<span class="o">}</span>

<span class="k">function </span>build_error <span class="o">{</span>
    <span class="o">{</span>
        <span class="nb">echo</span>
<span class="nb">        echo</span> <span class="s2">&quot;BUILD ERROR&quot;</span>
        <span class="nb">echo</span> <span class="k">$(</span>tail -n1 <span class="s2">&quot;$LOG_PATH&quot;</span><span class="k">)</span>
        <span class="nb">echo</span>
<span class="nb">        echo</span> <span class="s2">&quot;The Log is available here ${LOG_PATH}&quot;</span>
        <span class="nb">echo</span>
    <span class="o">}</span> &gt;&amp;3
    
    cleanup_abort
<span class="o">}</span>

<span class="k">function </span>cleanup_abort <span class="o">{</span>
    rm -rf <span class="s2">&quot;$PREFIX&quot;</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>

<p>Set up the directories needed for the source
and the downloaded packages.</p>

</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>

<p>Display the Usage message if no arguments are given.</p>

</td><td class=code><div class=highlight><pre>
init

<span class="nv">TIME</span><span class="o">=</span><span class="s2">&quot;$(date &quot;</span>+%Y%m%d%H%M%S<span class="s2">&quot;)&quot;</span>
<span class="nv">LOG_PATH</span><span class="o">=</span><span class="s2">&quot;$PHP_BUILD_ROOT/var/log/php-build/error.$DEFINITION.$TIME.log&quot;</span>

<span class="nb">exec </span>4&lt;&gt; <span class="s2">&quot;$LOG_PATH&quot;</span>

</pre></div></td></tr><tr><td class=docs>

<p>Check if the requested Definition exists.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> -z <span class="nv">$1</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>display_usage
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;--definitions&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>list_definitions
    <span class="nb">exit </span>0
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>

<p>Load all definition plugins. Plugins register functions
for use whithin definitions. See the xdebug and pyrus plugins for
examples.</p>

</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/definitions/$DEFINITION&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Definition $DEFINITION not found.&quot;</span> &gt;&amp;3
    <span class="nb">exit</span> <span class="nv">$E_DEFINITION_NOT_FOUND</span>
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>

<p>After Install Triggers are all executables placed in <code>triggers/after-install.d</code></p>

</td><td class=code><div class=highlight><pre>
load_plugins <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/plugins.d&quot;</span>

<span class="nb">echo</span> <span class="s2">&quot;$PHP_DEFAULT_INI gets used as php.ini&quot;</span>

<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;Building $DEFINITION into $PREFIX&quot;</span>
<span class="nb">echo</span>

<span class="nb">trap </span>cleanup_abort SIGINT SIGTERM

<span class="nb">trap </span>build_error ERR EXIT
<span class="nb">source</span> <span class="s2">&quot;$PHP_BUILD_ROOT/share/php-build/definitions/$DEFINITION&quot;</span>

</pre></div></td></tr><tr><td class=docs>

</td><td class=code><div class=highlight><pre>
trigger_after_install 2&gt;&amp;4

<span class="nb">trap</span> - ERR
<span class="nb">trap</span> - EXIT

<span class="k">if</span> <span class="o">[</span> -n <span class="nv">$LOG_PATH</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>log <span class="s2">&quot;Info&quot;</span> <span class="s2">&quot;The Log File is not empty, but the Build did not fail.\</span>
<span class="s2"> Maybe just warnings got logged.\</span>
<span class="s2"> You can review the log in $LOG_PATH&quot;</span>
<span class="k">fi</span>

log <span class="s2">&quot;Success&quot;</span> <span class="s2">&quot;Built $DEFINITION successfully.&quot;</span>


</pre></div></td></tr><tr><td class=docs>
</td><td class=code><div class=highlight><pre></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
